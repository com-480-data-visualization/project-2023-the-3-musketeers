<html lang="zh-CN" style="height: 100%">
<head>
  <!-- <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script> -->
  <!-- <script src="https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js"></script> -->
  <meta charset="utf-8">
<style>
  .container{
    width: 100%;
    height: 1000px;
    margin: 5px;
    background: #f6d7c1;
  } 
  
  #word-cloud{
    width: 90%;
    height: 400px;
    position: relative;
    left: 5%;
    background: #dcf0f4;
  }

  .float{
    float: left;
    width: 45%;
    position: relative;
    left: 5%;
  }

  #box-plot{
    width: 100%;
    height: 400px;
    position: relative;
    /* left: 5%; */
    background: #fbf4de;
  }

  #traits{
    width: 100%;
    height: 400px;
    position: relative;
    /* left: 55%; */
    background: #f0dcf4;
  }


</style>
</head>
<body style="margin: 10px">
<div class="container">
  <h3>Word Cloud</h3>
  <div id="word-cloud">
  </div>
  <div class = "float">
    <div id="box-plot"></div>
  </div>
  <div class = "float">
    <div id="traits"></div>
  </div>
  
  
</div>
 
<!-- <div class="controls">
  <div class="playpause">
    <input type="checkbox" value="None" id="playpause" name="check" />
    <label for="playpause" tabindex=1></label>
  </div>
  <div class="slider-container">
    <label for="cocoa-slider">Cocoa Percentage:</label>
    <input type="range" min="60" max="100" value="60" id="cocoa-slider" name="cocoa-slider">
  </div>
</div> -->

<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery"></script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
<script type="text/javascript">
// List of words
const myWords = [
    {text: "Hello", value:6260},
    {text: "happy", value:5370},
    {text: "beautiful", value:2480},
    {text: "rainbow", value:4350},
    {text: "unicorn", value:1250},
    {text: "glitter", value:3140},
    {text: "happy", value:990},
    {text: "grill", value:2000},
    {text: "blue", value:2900},
    {text: "nice", value:590},
    {text: "pie", value:4230}];
  
console.log(myWords)
var v_min = d3.min(myWords, function(d) {return(d.value);});
var v_max = d3.max(myWords, function(d) {return(d.value);});
var scale = d3.scaleLinear().domain([v_min,v_max]).range([20,80]);
myWords.map(function(obj) {obj.value = Math.round(scale(obj.value));});


var fill = d3.scaleOrdinal(d3.schemeCategory20);
// set the dimensions and margins of the graph
var margin = {top: 20, right: 20, bottom: 20, left: 20},
    width = document.getElementById("word-cloud").clientWidth - margin.left - margin.right,
    height = document.getElementById("word-cloud").clientHeight - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#word-cloud").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Constructs a new cloud layout instance. It run an algorithm to find the position of words that suits your requirements
// Wordcloud features that are different from one word to the other must be here
var layout = d3.layout.cloud()
  .size([width, height])
  .words(myWords)
  .padding(10)        //space between words
  .rotate(0)       // rotation angle in degrees
  .fontSize(function(d) {return d.value;})
  // .rotate(function() { return ~~(Math.random() * 2) * 90; })
  // .fontSize(20)      // font size of words
  .on("end", draw);
layout.start();

// This function takes the output of 'layout' above and draw the words
// Wordcloud features that are THE SAME from one word to the other can be here
function draw(words) {
  svg
    .append("g")
      .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
      .selectAll("text")
        .data(words)
        .enter()
        .append("text")
        .text((d) => d.text)
        .style("font-size", (d) => d.value)
        // .style("fill", "#69b3a2")
        .style("fill", (d, i) => fill(i))
        .attr("text-anchor", "middle")
        .style("font-family", "Impact")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.text; })
        .on("mouseover", handleMouseOver)
        .on("mouseout", handleMouseOut)
        .on("click", handleClick);

        function handleMouseOver(d) {
          d3.select(this)
            .transition()
            .duration(200)
            .style("opacity", 0.8)
            .style("font-size",d.size*1.1);
          // console.log(this);
        }

        function handleMouseOut(d) {
          d3.select(this)
            .transition()
            .duration(100)
            .style("opacity", 1)
            .style("font-size", d.size);
        }

        function handleClick(d) {
          console.log(d);
          var node = d3.select("#box-plot").node();
          console.log(node);
        }
}
</script>
<script type="text/javascript">

keyword = 'sugar'

var margin_box = {top: 10, right: 50, bottom: 10, left: 80},
    width_box = document.getElementById("box-plot").clientWidth - margin_box.left - margin_box.right,
    height_box = document.getElementById("box-plot").clientHeight - margin_box.top - margin_box.bottom;

// append the svg object to the body of the page
var svg = d3.select("#box-plot")
  .append("svg")
    .attr("width", width_box + margin_box.left + margin_box.right)
    .attr("height", height_box + margin_box.top + margin_box.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin_box.left + "," + margin_box.top + ")");


var returned = null
// Read the data and compute summary statistics for each specie
d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/iris.csv", function(data) {
  // Compute quartiles, median, inter quantile range min and max --> these info are then used to draw the box.
  var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
    .key(function(d) { return d.Species;})
    .rollup(function(d) {
      q1 = d3.quantile(d.map(function(g) { return g.Sepal_Length;}).sort(d3.ascending),.25)
      median = d3.quantile(d.map(function(g) { return g.Sepal_Length;}).sort(d3.ascending),.5)
      q3 = d3.quantile(d.map(function(g) { return g.Sepal_Length;}).sort(d3.ascending),.75)
      interQuantileRange = q3 - q1
      min = q1 - 1.5 * interQuantileRange
      max = q3 + 1.5 * interQuantileRange
      return({q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max})
    })
    .entries(data)


}) 




// self-defined data
 
var data_test = {"key": "sugar", "ratings": [ {"key":"with sugar",  "value": {"q1": 0.4, "q3": 0.5, "min": 0.1, "max": 0.8, "median": 0.55}}, {"key": "without sugar", "value": {"q1": 0.65, "q3": 0.7, "min": 0.5, "max": 0.75, "median": 0.66}}], "top5": [{"with": ["sweet", "smooth"]}, {"without": ["dry"], "percentage": "95%"}]}

// Show the X scale
var domain = ['with ' + keyword, 'without ' + keyword]
var x = d3.scaleBand()
  .range([ 0, width_box ])
  .domain(domain)
  .paddingInner(1)
  .paddingOuter(.5)
svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x))

// Show the Y scale
var y = d3.scaleLinear()
  .domain([0,1])
  .range([height_box, 0])
svg.append("g").call(d3.axisLeft(y))

// Show the main vertical line

// data only for this ingredient
data_this = data_test.ratings 
console.log('data this: ', data_this)
ingredient = data_test.key

svg
  .selectAll("vertLines")
  .data(data_this)
  .enter()
  .append("line")
    .attr("x1", function(d){return(x(d.key))})
    .attr("x2", function(d){return(x(d.key))})
    .attr("y1", function(d){return(y(d.value.min))})
    .attr("y2", function(d){return(y(d.value.max))})
    .attr("stroke", "black")
    .style("width", 40)

// rectangle for the main box
var boxWidth = 60
svg
  .selectAll("boxes")
  .data(data_this)
  .enter()
  .append("rect")
      .attr("x", function(d){return(x(d.key)-boxWidth/2)})
      .attr("y", function(d){return(y(d.value.q3))})
      .attr("height", function(d){return(y(d.value.q1)-y(d.value.q3))})
      .attr("width", boxWidth )
      .attr("stroke", "black")
      .style("fill", "#69b3a2")

// Show the median
svg
  .selectAll("medianLines")
  .data(data_this)
  .enter()
  .append("line")
    .attr("x1", function(d){return(x(d.key)-boxWidth/2) })
    .attr("x2", function(d){return(x(d.key)+boxWidth/2) })
    .attr("y1", function(d){return(y(d.value.median))})
    .attr("y2", function(d){return(y(d.value.median))})
    .attr("stroke", "black")
    .style("width", 80)
// })




</script> 

</body>
</html>
